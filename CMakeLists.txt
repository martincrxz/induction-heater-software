cmake_minimum_required(VERSION 3.1.0)
project(TrabajoProfesional)
# Cambiar esto a false cuando se haga el release
if (DEBUG)
	set(DEBUG_MODE TRUE)
	set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DDEBUG_INJECTION")
	message(STATUS "[INFO] DEBUG MODE ENABLED")
endif()

if (NOT DEFINED QT_VER) 
	# opción por default
	set(QT_VER "5.13.0")
endif()
message(STATUS "[INFO] QT version: ${QT_VER}")

# Definición de macros de compilación para usuarios MacOs.
if(${CMAKE_SYSTEM_NAME} STREQUAL "Darwin")
	message(STATUS "[INFO] COMPILING FOR MACOS")
	set(CMAKE_PREFIX_PATH "/usr/local/Cellar/qt/${QT_VER}/")
elseif(${CMAKE_SYSTEM_NAME} STREQUAL "Windows")
	message(STATUS "[INFO] COMPILING FOR WINDOWS")
	set(QT5_DLL_DIR "C:\\Qt\\${QT_VER}\\msvc2017\\bin")
	set(Qt5_DIR "C:\\Qt\\${QT_VER}\\msvc2017\\lib\\cmake\\Qt5")
	set(IS_WINDOWS TRUE)
else()
	message(STATUS "[INFO] COMPILING FOR LINUX")
endif()

if(IS_WINDOWS)
	message(STATUS "[INFO] Copying .dll files to the current directory")
else()
	if(DEBUG_MODE)
		set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O0 -std=c++14 -Wall -pedantic -pthread")
	else()
		set (CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O0 -std=c++14 -Wall -pedantic -pthread")
	endif()
endif()

message(STATUS "[INFO] Setting flags = '${CMAKE_CXX_FLAGS}'")

message(STATUS "[INFO] Including portable-endian project")

# Adding autogenerated portable-endian.h file to the include directories
message(STATUS "[INFO] Adding '${CMAKE_BINARY_DIR}/libs/portable-endian' as include directory")

message(STATUS "[INFO] Adding '${CMAKE_SOURCE_DIR}/libs' as include directory")
include_directories(${CMAKE_SOURCE_DIR}/libs)

message(STATUS "[INFO] Loading sources")
file(GLOB_RECURSE SOURCES RELATIVE ${CMAKE_SOURCE_DIR} "src/*.cpp" "src/*.h" "libs/*.h" "libs/*.cpp")

message(STATUS "[INFO] Loading sources of QT")

# Find the QtWidgets library
find_package(Qt5 COMPONENTS Core Widgets Charts SerialPort REQUIRED)

qt5_wrap_ui(UIS_HEADERS
        src/view/auto_tunning_tab_view.ui
        src/view/automatic_control_tab_view.ui
        src/view/chart_tab_view.ui
        src/view/equipment_status_view.ui
        src/view/general_view.ui
        src/view/manual_power_control_view.ui
        src/view/control_configuration/classic_control_view.ui
        src/view/control_configuration/fuzzy_control_view.ui
		src/view/control_configuration/from_file_control_view.ui
		src/view/chart/chart_widget.ui
		src/view/chart/chart_config_dialog.ui
        )
# Instruct CMake to run moc automatically when neededcd
set(CMAKE_AUTOMOC ON)
# Create code from a list of Qt designer ui files
set(CMAKE_AUTORCC ON)

# Adding directory with the autogenerated headers as include directory
message(STATUS "[INFO] Adding '${PROJECT_BINARY_DIR}' as include directory")
include_directories(${PROJECT_BINARY_DIR})

message(STATUS "[INFO] Headers autogenerated: ${UIS_HEADERS}")

file(GLOB RESOURCES ${CMAKE_SOURCE_DIR}
        "assets/resources.qrc")

# Tell CMake to create the helloworld executable
add_executable(application ${SOURCES} ${UIS_HEADERS} ${RESOURCES} src/control/zieglers_nichols.cpp src/control/zieglers_nichols.h)

message(STATUS "[INFO] Add Qt components to the target link libraries")
if(IS_WINDOWS)
	message(STATUS "[INFO] Adding ws2_32 to the target link libraries")
	target_link_libraries(application ws2_32 Qt5::Core Qt5::Widgets Qt5::Charts Qt5::SerialPort)
else()
	target_link_libraries(application Qt5::Core Qt5::Widgets Qt5::Charts Qt5::SerialPort)

endif()
# Install phase (commented until necessary)
#file(COPY assets DESTINATION ./)
#file(COPY serverConfig.yaml DESTINATION ./)
#file(COPY defaultWeapons.yaml DESTINATION ./)
#file(COPY res DESTINATION ./)

#message(STATUS "[INFO] Adding Installation directives")
#INSTALL(TARGETS worms_client worms_server worms_editor DESTINATION /usr/bin)
#INSTALL(DIRECTORY assets DESTINATION /var/Worms)
#INSTALL(DIRECTORY res DESTINATION /var/Worms)
#INSTALL(FILES defaultWeapons.yaml serverConfig.yaml DESTINATION /etc/Worms)
